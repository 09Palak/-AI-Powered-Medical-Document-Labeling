<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medical Document Analyzer</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" xintegrity="sha384-QWTKZyjpPEjISv5WaRU9Oer+R4oQzWkM9iCbI2dFUVXGm9U+B7sH1l5P" crossorigin="anonymous">
    <style>
        body {
            background-color: #f8f9fa; /* Light gray background */
        }
        .container {
            max-width: 800px; /* Limit container width */
        }
        .card {
            border-radius: 15px; /* Rounded corners for the card */
            box-shadow: 0 4px 8px rgba(0,0,0,0.1); /* Subtle shadow */
        }
        .form-label {
            font-weight: bold;
        }
        .btn-primary {
            background-color: #28a745; /* Green button */
            border-color: #28a745;
        }
        .btn-primary:hover {
            background-color: #218838;
            border-color: #1e7e34;
        }
        .header-bg {
            background-color: #007bff; /* Blue header background */
            color: white;
            border-top-left-radius: 15px;
            border-top-right-radius: 15px;
            padding: 15px 0;
            margin-bottom: 20px;
        }
        .header-bg h3 {
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .header-bg h3 svg {
            margin-right: 10px;
        }
        #loadingSpinner {
            display: none; /* Hidden by default */
        }
        .alert-message {
            display: none; /* Hidden by default */
        }
    </style>
</head>
<body>
    <div class="container my-5">
        <div class="card">
            <div class="card-header text-center header-bg">
                <h3>
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-file-earmark-medical-fill" viewBox="0 0 16 16">
                        <path d="M9.293 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V4.707A1 1 0 0 0 13.707 4L10 .293A1 1 0 0 0 9.293 0M9.5 3.5v-2l3 3h-2a1 1 0 0 1-1-1M7.5 4a.5.5 0 0 0 0 1h1a.5.5 0 0 0 0-1zM7 7.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5m.5 2a.5.5 0 0 0 0 1h1a.5.5 0 0 0 0-1zM7 12.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5"/>
                    </svg>
                    Medical Document Analyzer
                </h3>
            </div>
            <div class="card-body p-4">
                <form id="documentUploadForm">
                    <div class="mb-3">
                        <label for="name" class="form-label">Name:</label>
                        <input type="text" class="form-control rounded-pill" id="name" name="name" placeholder="Enter your name" required>
                    </div>
                    <div class="mb-3">
                        <label for="email" class="form-label">Email:</label>
                        <input type="email" class="form-control rounded-pill" id="email" name="email" placeholder="Enter your email" required>
                    </div>
                    <div class="mb-3">
                        <label for="phone" class="form-label">Phone Number:</label>
                        <input type="tel" class="form-control rounded-pill" id="phone" name="phone" placeholder="Enter your phone number">
                    </div>
                    <div class="mb-3">
                        <label for="gender" class="form-label">Gender:</label>
                        <select class="form-select rounded-pill" id="gender" name="gender" required>
                            <option value="" disabled selected>Select Gender</option>
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                            <option value="Other">Other</option>
                            <option value="Prefer not to say">Prefer not to say</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label for="document_file" class="form-label">Upload Document (PDF or Image):</label>
                        <input type="file" class="form-control" id="document_file" name="document_file" accept=".pdf,.jpg,.jpeg,.png" required>
                    </div>

                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-primary btn-lg rounded-pill">
                            <span id="buttonText">Analyze Document</span>
                            <span id="loadingSpinner" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                        </button>
                    </div>

                    <div id="alertMessage" class="alert alert-danger mt-3 alert-message" role="alert">
                        </div>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" xintegrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <script>
        document.getElementById('documentUploadForm').addEventListener('submit', async function(event) {
            event.preventDefault(); // Prevent default form submission

            const form = event.target;
            const formData = new FormData(form);
            const submitButton = form.querySelector('button[type="submit"]');
            const buttonText = document.getElementById('buttonText');
            const loadingSpinner = document.getElementById('loadingSpinner');
            const alertMessage = document.getElementById('alertMessage');

            // Show loading state
            submitButton.disabled = true;
            buttonText.textContent = 'Analyzing...';
            loadingSpinner.style.display = 'inline-block';
            alertMessage.style.display = 'none'; // Hide previous alerts

            try {
                // Send data to Flask backend
                const response = await fetch('/analyze_document', {
                    method: 'POST',
                    body: formData // FormData handles multipart/form-data automatically
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || `HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                console.log('Analysis Result:', result);

                // Store the result in sessionStorage to pass to the result page
                sessionStorage.setItem('analysisResult', JSON.stringify(result));

                // Redirect to the result page
                window.location.href = '/result';

            } catch (error) {
                console.error('Error during analysis:', error);
                alertMessage.textContent = `Analysis failed: ${error.message}. Please try again.`;
                alertMessage.style.display = 'block'; // Show error message
            } finally {
                // Revert button state
                submitButton.disabled = false;
                buttonText.textContent = 'Analyze Document';
                loadingSpinner.style.display = 'none';
            }
        });
    </script>
</body>
</html>
